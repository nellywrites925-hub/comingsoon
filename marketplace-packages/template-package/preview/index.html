<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Template Preview Collage</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0f1115;
        --panel: #161a23;
        --accent: #667eea;
        --gradient: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 50%,
          #f093fb 100%
        );
        --radius: 18px;
        --grid-gap: 1.5rem;
        --shadow: 0 10px 25px -8px rgba(0, 0, 0, 0.55);
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        background: radial-gradient(circle at 20% 20%, #1d2230 0%, #0f1115 70%);
        color: #fff;
        padding: 2.5rem clamp(1rem, 3vw, 3rem) 4rem;
      }
      body.fit-contain .shot img {
        object-fit: contain;
        background: #0d1016;
      }
      body.fit-cover .shot img {
        object-fit: cover;
      }
      body.fit-contain .device-phone img {
        background: #000;
      }
      .controls-bar {
        position: sticky;
        top: 0;
        z-index: 50;
        display: flex;
        flex-wrap: wrap;
        gap: 0.85rem;
        align-items: center;
        background: rgba(15, 17, 22, 0.85);
        backdrop-filter: blur(8px);
        padding: 0.85rem 1rem;
        margin: 0 0 1.75rem;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        box-shadow: 0 8px 18px -6px rgba(0, 0, 0, 0.55);
      }
      .controls-bar label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.9px;
        font-weight: 600;
        opacity: 0.75;
        display: block;
        margin-bottom: 0.25rem;
      }
      .controls-group {
        display: flex;
        flex-direction: column;
        min-width: 110px;
      }
      .controls-bar select,
      .controls-bar input[type="range"] {
        appearance: none;
        background: #1e2430;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: #fff;
        padding: 0.45rem 0.6rem;
        font: 500 0.75rem/1.2 Poppins, sans-serif;
        border-radius: 8px;
        min-width: 140px;
      }
      .controls-bar input[type="number"] {
        appearance: textfield;
        background: #1e2430;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: #fff;
        padding: 0.35rem 0.4rem;
        font: 500 0.65rem/1.1 Poppins, sans-serif;
        border-radius: 6px;
        width: 72px;
      }
      .controls-bar button.small-btn {
        background: var(--accent);
        border: none;
        color: #fff;
        font: 600 0.6rem/1 Poppins, sans-serif;
        padding: 0.45rem 0.65rem;
        border-radius: 6px;
        cursor: pointer;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 10px -3px rgba(0, 0, 0, 0.5);
        transition: background 0.25s ease, opacity 0.25s ease;
      }
      .controls-bar button.small-btn:is(:hover, :focus) {
        background: #5466d5;
      }
      .controls-bar button.small-btn:active {
        opacity: 0.7;
      }
      .controls-bar input[type="range"] {
        padding: 0;
        height: 34px;
      }
      .scale-indicator {
        font-size: 0.7rem;
        opacity: 0.65;
        margin-top: 0.25rem;
        text-align: center;
      }
      .shot-inner {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .shot-inner img {
        transition: transform 0.35s ease, filter 0.35s ease;
      }
      body.scaling-active .shot-inner img {
        will-change: transform;
      }
      .ratio-desktop .shot-inner {
        aspect-ratio: 16/10;
      }
      .ratio-wide .shot-inner {
        aspect-ratio: 16/9;
      }
      .full-span {
        grid-column: span 2;
      }
      @media (max-width: 900px) {
        .full-span {
          grid-column: span 1;
        }
      }
      .ratio-phone .shot-inner {
        aspect-ratio: 9/19.5;
      }
      .device-desktop .shot-inner img {
        height: 100%;
        width: 100%;
        object-fit: inherit;
      }
      .device-phone .shot-inner img {
        height: 100%;
        width: 100%;
        object-fit: inherit;
      }
      header {
        max-width: 1200px;
        margin: 0 auto 2.5rem;
      }
      h1 {
        font-size: clamp(2rem, 4vw, 3.2rem);
        margin: 0.25rem 0;
        font-weight: 700;
        letter-spacing: 0.5px;
      }
      p.lead {
        opacity: 0.8;
        max-width: 880px;
        line-height: 1.5;
        font-size: 1.05rem;
        margin: 0 0 1rem;
      }
      .badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.65rem;
        margin-top: 0.5rem;
      }
      .badge {
        background: rgba(255, 255, 255, 0.07);
        padding: 0.4rem 0.85rem;
        border-radius: 50px;
        font-size: 0.7rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
      }

      .collage-grid {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        gap: var(--grid-gap);
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        align-items: stretch;
      }

      .tile {
        position: relative;
        background: linear-gradient(145deg, #171d27, #0c0f14);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: var(--radius);
        padding: 1rem;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: var(--shadow);
      }
      .tile:before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at 80% -10%,
          rgba(255, 255, 255, 0.08),
          transparent 60%
        );
        pointer-events: none;
      }
      .tile h3 {
        margin: 0.2rem 0 0.75rem;
        font-size: 0.95rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #dce2f5;
      }
      .shot {
        position: relative;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .shot img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
        filter: brightness(0.93) saturate(1.05);
        box-shadow: 0 6px 16px -4px rgba(0, 0, 0, 0.6);
      }
      /* Active tile highlight for per-image scaling */
      .tile.active-scale {
        outline: 2px solid var(--accent);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.35), var(--shadow);
      }
      .tile.active-scale .shot-inner img {
        filter: brightness(1) saturate(1.08);
      }

      /* Floating per-image scale panel */
      .local-scale-panel {
        position: fixed;
        bottom: 18px;
        left: 18px;
        background: rgba(20, 24, 32, 0.92);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 0.75rem 0.9rem 0.85rem;
        border-radius: 14px;
        font: 500 0.65rem/1.2 Poppins, sans-serif;
        color: #dfe6fb;
        width: 240px;
        z-index: 1200;
        box-shadow: 0 10px 28px -10px rgba(0, 0, 0, 0.65);
        display: none;
      }
      .local-scale-panel header {
        font: 600 0.6rem/1.2 Poppins, sans-serif;
        letter-spacing: 0.75px;
        text-transform: uppercase;
        opacity: 0.75;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .local-scale-panel input[type="range"] {
        width: 100%;
        margin: 4px 0 2px;
      }
      .local-scale-panel .close-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 14px;
        cursor: pointer;
        font-weight: 600;
        opacity: 0.6;
      }
      .local-scale-panel .close-btn:hover {
        opacity: 1;
      }
      .local-scale-panel .actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 4px;
      }
      .local-scale-panel .reset-btn {
        background: #2a3140;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: #fff;
        font: 600 0.55rem/1 Poppins, sans-serif;
        padding: 4px 6px;
        border-radius: 6px;
        cursor: pointer;
        letter-spacing: 0.5px;
      }
      .local-scale-panel .reset-btn:hover {
        background: #364152;
      }

      /* Export overlay */
      #exportOverlay {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 2px dashed rgba(255, 255, 255, 0.75);
        border-radius: 10px;
        background: rgba(102, 126, 234, 0.05);
        box-shadow: 0 0 0 120vmax rgba(15, 17, 22, 0.55);
        display: none;
        z-index: 1100;
        cursor: move;
      }
      #exportOverlay .dim-label {
        position: absolute;
        top: 4px;
        left: 50%;
        transform: translateX(-50%);
        font: 600 11px/1.1 Poppins, sans-serif;
        letter-spacing: 0.5px;
        background: rgba(15, 17, 22, 0.85);
        padding: 4px 8px 5px;
        border-radius: 20px;
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.15);
        pointer-events: none;
      }
      body.overlay-active #exportOverlay {
        display: block;
      }
      .overlay-locked #exportOverlay {
        cursor: default;
      }
      .controls-bar .inline-note {
        font-size: 0.55rem;
        opacity: 0.55;
        line-height: 1.2;
        margin-top: 4px;
        max-width: 160px;
      }

      /* Device frames */
      .device-phone {
        background: #0d1016;
        padding: 12px 10px 18px;
        border-radius: 34px;
        position: relative;
        box-shadow: 0 10px 24px -8px rgba(0, 0, 0, 0.65),
          inset 0 0 0 2px rgba(255, 255, 255, 0.08);
      }
      .device-phone:before {
        content: "";
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 34%;
        height: 10px;
        background: #11151c;
        border-radius: 0 0 12px 12px;
      }
      .device-phone img {
        border-radius: 22px;
        height: 460px;
        width: auto;
        object-fit: cover;
      }

      .device-desktop {
        background: #0d1016;
        padding: 14px 14px 10px;
        border-radius: 20px 20px 14px 14px;
        position: relative;
        box-shadow: 0 10px 24px -8px rgba(0, 0, 0, 0.65),
          inset 0 0 0 2px rgba(255, 255, 255, 0.08);
      }
      .device-desktop:before {
        content: "";
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 70px;
        height: 8px;
        background: #141921;
        border-radius: 8px;
      }
      .device-desktop img {
        border-radius: 8px;
        height: 100%;
      }

      /* Highlight tile */
      .highlight {
        grid-column: span 2;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        align-items: stretch;
      }
      .highlight .info {
        padding: 1rem 1.25rem 1.75rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .gradient-text {
        background: var(--gradient);
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
        font-weight: 700;
      }

      ul.feature-list {
        list-style: none;
        margin: 1rem 0 0;
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.6rem 0.75rem;
        font-size: 0.8rem;
      }
      ul.feature-list li {
        display: flex;
        align-items: center;
        gap: 0.45rem;
        background: rgba(255, 255, 255, 0.05);
        padding: 0.5rem 0.65rem;
        border-radius: 8px;
        line-height: 1.2;
      }
      ul.feature-list li:before {
        content: "✔";
        font-size: 0.7rem;
        color: #7f9bff;
      }

      footer {
        max-width: 1100px;
        margin: 3.5rem auto 0;
        padding: 1.5rem 0 2rem;
        font-size: 0.75rem;
        opacity: 0.65;
        text-align: center;
        letter-spacing: 0.5px;
      }

      @media (max-width: 980px) {
        .highlight {
          grid-column: span 1;
        }
        .device-phone img {
          height: 380px;
        }
      }
      @media (max-width: 640px) {
        body {
          padding: 2rem 1.25rem 3rem;
        }
        .badge-row {
          gap: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        <span class="gradient-text">Under Construction</span> Template Preview
      </h1>
      <p class="lead">
        Use these arranged screenshots to export your marketplace preview images
        (desktop, mobile, features & marketing composites). Replace placeholder
        file names with your real screenshots.
      </p>
      <div class="badge-row">
        <span class="badge">Bootstrap 5</span>
        <span class="badge">Responsive</span>
        <span class="badge">Countdown</span>
        <span class="badge">Email Capture</span>
        <span class="badge">Animations</span>
        <span class="badge">SEO Ready</span>
      </div>
    </header>

    <main class="collage-grid">
      <!-- HIGHLIGHT / DESKTOP FEATURE SECTION -->
      <section class="tile highlight">
        <div class="shot device-desktop ratio-desktop">
          <div class="shot-inner">
            <img
              src="./raw/desktop.jpg"
              alt="Desktop View"
              loading="lazy"
              data-fallback="Desktop.JPG"
            />
          </div>
        </div>
        <div class="info">
          <h3>Core Features</h3>
          <ul class="feature-list">
            <li>Real-time Countdown Timer</li>
            <li>Animated Particle Background</li>
            <li>Email Subscription Form</li>
            <li>Progress Indicators</li>
            <li>Accessible Markup</li>
            <li>SEO Optimized</li>
            <li>Mobile First Layout</li>
            <li>Social Links Ready</li>
            <li>Google Fonts (Poppins)</li>
            <li>Bootstrap 5 Grid</li>
            <li>Lazy Loaded Assets</li>
            <li>Clean, Commented Code</li>
          </ul>
        </div>
      </section>

      <!-- MOBILE LARGE -->
      <section class="tile">
        <h3>Mobile - iPhone 14 Pro Max</h3>
        <div class="shot device-phone ratio-phone">
          <div class="shot-inner">
            <img
              src="./raw/mobile-large.jpg"
              alt="iPhone Large"
              loading="lazy"
              data-fallback="iphone19pm.JPG"
            />
          </div>
        </div>
      </section>

      <!-- MOBILE SMALL -->
      <section class="tile">
        <h3>Mobile - iPhone SE</h3>
        <div class="shot device-phone ratio-phone">
          <div class="shot-inner">
            <img
              src="./raw/mobile-small.jpg"
              alt="iPhone Small"
              loading="lazy"
              data-fallback="iphonese.JPG"
            />
          </div>
        </div>
      </section>

      <!-- CONTACT SECTION -->
      <section class="tile">
        <h3>Contact Section</h3>
        <div class="shot">
          <div class="shot-inner">
            <img
              src="./raw/contact-section.jpg"
              alt="Contact Section"
              loading="lazy"
              data-fallback="contact.JPG"
            />
          </div>
        </div>
      </section>

      <!-- PROGRESS SECTION -->
      <section class="tile">
        <h3>Development Progress</h3>
        <div class="shot">
          <div class="shot-inner">
            <img
              src="./raw/progress-bars.jpg"
              alt="Progress Bars"
              loading="lazy"
              data-fallback="devprogbar.JPG"
            />
          </div>
        </div>
      </section>

      <!-- MOBILE COMPOSITE EXPORT AREA -->
      <section
        class="tile"
        style="
          grid-column: span 2;
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
          gap: 1.25rem;
          align-items: center;
        "
      >
        <h3 style="grid-column: 1/-1; margin-top: 0">
          Mobile Composite Export Area
        </h3>
        <div class="shot device-phone ratio-phone">
          <div class="shot-inner">
            <img
              src="./raw/mobile-large.jpg"
              alt="iPhone Large"
              loading="lazy"
              data-fallback="iphone19pm.JPG"
            />
          </div>
        </div>
        <div class="shot device-phone ratio-phone">
          <div class="shot-inner">
            <img
              src="./raw/mobile-small.jpg"
              alt="iPhone Small"
              loading="lazy"
              data-fallback="iphonese.JPG"
            />
          </div>
        </div>
        <div
          style="
            grid-column: 1/-1;
            font-size: 0.75rem;
            opacity: 0.7;
            line-height: 1.35;
            text-align: center;
            padding-top: 0.25rem;
          "
        >
          Capture this entire section at a wide ratio (suggest 1600x900) for
          your mobile composite preview image.
        </div>
      </section>
    </main>

    <footer>
      Generated Preview Layout • Replace file paths then capture at target
      dimensions (ThemeForest main: 1160x870, features: 1160x580, mobile
      composite: 1600x900).
    </footer>
    <div id="exportOverlay"><div class="dim-label"></div></div>
    <div
      class="local-scale-panel"
      id="localScalePanel"
      role="dialog"
      aria-label="Per Image Scaling"
    >
      <header>
        <span>Per-Image Scale</span>
        <button class="close-btn" title="Close" aria-label="Close">×</button>
      </header>
      <div
        style="
          font-size: 0.6rem;
          opacity: 0.7;
          line-height: 1.25;
          margin-bottom: 4px;
        "
      >
        Adjust just the selected tile without affecting others. Multiplies with
        global scale.
      </div>
      <label
        style="
          font-size: 0.55rem;
          text-transform: uppercase;
          letter-spacing: 0.6px;
          opacity: 0.65;
          display: block;
          margin-bottom: 2px;
        "
        >Local Scale <span id="localScaleValue">100</span>%</label
      >
      <input type="range" min="50" max="160" value="100" id="localScaleRange" />
      <div class="actions">
        <button class="reset-btn" type="button">Reset</button>
        <div style="font-size: 0.5rem; opacity: 0.55; text-align: right">
          ESC to clear
        </div>
      </div>
    </div>
  </body>
  <script>
    // UI Controls for fit mode & scale
    (function () {
      const header = document.querySelector("header");
      const bar = document.createElement("div");
      bar.className = "controls-bar";
      bar.innerHTML = `
        <div class="controls-group">
          <label for="fitSelect">Image Fit</label>
          <select id="fitSelect">
            <option value="cover" selected>Cover (Fill)</option>
            <option value="contain">Contain (Full Image)</option>
          </select>
        </div>
        <div class="controls-group">
          <label for="scaleRange">Scale (<span id="scaleValue">100</span>%)</label>
          <input type="range" id="scaleRange" min="60" max="140" value="100" />
          <div class="scale-indicator">Adjust to avoid cropping</div>
        </div>
        <div class="controls-group" style="min-width:180px;">
          <label for="overlayPreset">Export Overlay</label>
          <select id="overlayPreset">
            <option value="">None</option>
            <option value="1160x580">1160x580 (Features)</option>
            <option value="1160x870">1160x870 (Main)</option>
            <option value="1600x900">1600x900 (Composite)</option>
            <option value="custom">Custom…</option>
          </select>
          <div class="custom-size" style="display:none; margin-top:6px; display:flex; gap:6px; align-items:center; flex-wrap:wrap;">
            <input type="number" id="customW" placeholder="W" min="200" />
            <input type="number" id="customH" placeholder="H" min="200" />
            <button type="button" class="small-btn" id="applyCustom">Set</button>
            <button type="button" class="small-btn" id="centerOverlay" title="Center Overlay">Center</button>
          </div>
          <div class="inline-note">Use for precise capture guides. Drag to position; Center to re-align.</div>
        </div>
        <div class="controls-group" style="min-width:180px;">
          <label>Tips</label>
          <div style="font-size:.6rem;line-height:1.2;opacity:.65;max-width:190px;">Use Cover for marketing punch. Switch to Contain to ensure full page shows before exporting.</div>
        </div>
      `;
      header.parentNode.insertBefore(bar, header.nextSibling);
      const fitSelect = bar.querySelector("#fitSelect");
      const scaleRange = bar.querySelector("#scaleRange");
      const scaleValue = bar.querySelector("#scaleValue");
      const overlayPreset = bar.querySelector("#overlayPreset");
      const customBox = bar.querySelector(".custom-size");
      const customW = bar.querySelector("#customW");
      const customH = bar.querySelector("#customH");
      const applyCustom = bar.querySelector("#applyCustom");
      const centerOverlayBtn = bar.querySelector("#centerOverlay");
      const overlayEl = document.getElementById("exportOverlay");
      const dimLabel = overlayEl.querySelector(".dim-label");

      function setOverlaySize(w, h) {
        overlayEl.style.width = w + "px";
        overlayEl.style.height = h + "px";
        dimLabel.textContent = w + " x " + h;
      }

      function activateOverlay(w, h) {
        setOverlaySize(w, h);
        document.body.classList.add("overlay-active");
        // recenters
        overlayEl.style.top = "50%";
        overlayEl.style.left = "50%";
        overlayEl.style.transform = "translate(-50%, -50%)";
      }

      overlayPreset.addEventListener("change", () => {
        const val = overlayPreset.value;
        if (!val) {
          document.body.classList.remove("overlay-active");
          customBox.style.display = "none";
          return;
        }
        if (val === "custom") {
          customBox.style.display = "flex";
          customW.focus();
          return;
        }
        customBox.style.display = "none";
        const [w, h] = val.split("x").map(Number);
        activateOverlay(w, h);
      });

      applyCustom.addEventListener("click", () => {
        const w = parseInt(customW.value, 10);
        const h = parseInt(customH.value, 10);
        if (w && h) activateOverlay(w, h);
      });
      centerOverlayBtn.addEventListener("click", () => {
        overlayEl.style.top = "50%";
        overlayEl.style.left = "50%";
        overlayEl.style.transform = "translate(-50%, -50%)";
      });

      // Drag logic
      (function () {
        let dragging = false,
          startX = 0,
          startY = 0,
          startLeft = 0,
          startTop = 0;
        overlayEl.addEventListener("mousedown", (e) => {
          dragging = true;
          overlayEl.classList.add("dragging");
          startX = e.clientX;
          startY = e.clientY;
          // remove translate if centered
          const rect = overlayEl.getBoundingClientRect();
          startLeft = rect.left;
          startTop = rect.top;
          overlayEl.style.transform = "none";
          e.preventDefault();
        });
        window.addEventListener("mousemove", (e) => {
          if (!dragging) return;
          const dx = e.clientX - startX;
          const dy = e.clientY - startY;
          overlayEl.style.left = startLeft + dx + "px";
          overlayEl.style.top = startTop + dy + "px";
        });
        window.addEventListener("mouseup", () => {
          dragging = false;
          overlayEl.classList.remove("dragging");
        });
      })();

      document.body.classList.add("fit-cover");
      fitSelect.addEventListener("change", () => {
        document.body.classList.remove("fit-cover", "fit-contain");
        document.body.classList.add("fit-" + fitSelect.value);
      });
      // central transform update
      function updateTransforms() {
        const g = parseFloat(scaleRange.value) / 100;
        document.querySelectorAll(".shot-inner img").forEach((img) => {
          const local = parseFloat(img.dataset.localScale || "1");
          img.style.transform = "scale(" + g * local + ")";
        });
      }
      scaleRange.addEventListener("input", () => {
        scaleValue.textContent = scaleRange.value;
        document.body.classList.add("scaling-active");
        updateTransforms();
      });
      window.__updateTransforms = updateTransforms; // debug hook
    })();
    // Missing image diagnostics & fallback helper
    (function () {
      const imgs = [...document.querySelectorAll("img")];
      const report = [];
      // fallback attempt: if primary src 404s and data-fallback exists, retry
      imgs.forEach((img) => {
        img.addEventListener(
          "error",
          () => {
            const fb = img.getAttribute("data-fallback");
            if (fb && !img.dataset.triedFb) {
              img.dataset.triedFb = "1";
              const original = img.getAttribute("src");
              // try original legacy name
              img.setAttribute("src", "./raw/" + fb);
              console.info(
                "Retrying with fallback file name for",
                original,
                "→",
                fb
              );
              return; // skip marking missing until fallback also fails
            }
            img.style.outline = "3px solid #ff4d4f";
            img.style.position = "relative";
            const note = document.createElement("div");
            note.textContent = "Missing: " + img.getAttribute("src");
            note.style.cssText =
              "position:absolute;inset:6px auto auto 6px;background:#ff4d4f; color:#fff; font:600 11px/1.2 Poppins,sans-serif;padding:6px 8px;border-radius:6px;max-width:180px;box-shadow:0 4px 10px -2px rgba(0,0,0,.4);z-index:5;";
            img.parentElement.style.position = "relative";
            img.parentElement.appendChild(note);
            report.push(img.getAttribute("src"));
          },
          { once: true }
        );
      });
      window.addEventListener("load", () => {
        if (report.length) {
          console.group("Preview Missing Images");
          console.warn("The following image paths did not resolve:", report);
          console.info(
            "Fix: Ensure files are inside preview/raw/ (not in a nested folder). Current structure includes an extra folder name. Move the JPG files up one level."
          );
          console.groupEnd();
          const tip = document.createElement("div");
          tip.innerHTML =
            "⚠ Some screenshots are not loading.<br><strong>Fix:</strong> Move your JPG files directly into <code>preview/raw/</code> (remove any inner “coming soon demo shots” folder) or adjust the <code>src</code> paths.";
          tip.style.cssText =
            "position:fixed;bottom:18px;right:18px;background:#1e242f;padding:14px 16px;border:1px solid #ff4d4f;color:#fff;font:500 12.5px/1.4 Poppins,sans-serif;border-radius:10px;box-shadow:0 10px 28px -8px rgba(0,0,0,.55);max-width:280px;z-index:9999;";
          const close = document.createElement("button");
          close.textContent = "×";
          close.style.cssText =
            "position:absolute;top:4px;right:8px;background:none;border:none;color:#fff;font-size:16px;cursor:pointer;font-weight:600;";
          close.onclick = () => tip.remove();
          tip.appendChild(close);
          document.body.appendChild(tip);
        }
      });
    })();
    // Per-image scaling logic
    (function () {
      const panel = document.getElementById("localScalePanel");
      const range = document.getElementById("localScaleRange");
      const valueEl = document.getElementById("localScaleValue");
      const closeBtn = panel.querySelector(".close-btn");
      const resetBtn = panel.querySelector(".reset-btn");
      let activeTile = null;

      function openPanel(tile) {
        panel.style.display = "block";
        activeTile = tile;
        document
          .querySelectorAll(".tile.active-scale")
          .forEach((t) => t.classList.remove("active-scale"));
        tile.classList.add("active-scale");
        const img = tile.querySelector(".shot-inner img");
        const local = parseFloat(img?.dataset.localScale || "1");
        range.value = Math.round(local * 100);
        valueEl.textContent = Math.round(local * 100);
      }
      function closePanel() {
        panel.style.display = "none";
        if (activeTile) activeTile.classList.remove("active-scale");
        activeTile = null;
      }
      function updateLocal() {
        if (!activeTile) return;
        const img = activeTile.querySelector(".shot-inner img");
        if (!img) return;
        const local = parseInt(range.value, 10) / 100;
        img.dataset.localScale = local;
        valueEl.textContent = Math.round(local * 100);
        // recompute transforms with global
        if (window.__updateTransforms) window.__updateTransforms();
      }
      range.addEventListener("input", updateLocal);
      closeBtn.addEventListener("click", closePanel);
      resetBtn.addEventListener("click", () => {
        if (!activeTile) return;
        const img = activeTile.querySelector(".shot-inner img");
        if (img) {
          delete img.dataset.localScale;
          range.value = 100;
          valueEl.textContent = "100";
          if (window.__updateTransforms) window.__updateTransforms();
        }
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closePanel();
      });
      // Activate on tile click
      document.querySelectorAll(".tile").forEach((tile) => {
        tile.addEventListener("click", (e) => {
          // ignore clicks inside panel injection or controls bar
          if (
            e.target.closest(".controls-bar") ||
            e.target.closest("#exportOverlay")
          )
            return;
          openPanel(tile);
        });
      });
      // Outside click to close (avoid closing when clicking inside tile itself)
      document.addEventListener("click", (e) => {
        if (
          !panel.contains(e.target) &&
          !e.target.closest(".tile") &&
          activeTile
        ) {
          closePanel();
        }
      });
    })();
  </script>
</html>
